!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){self;const r=n(1),a=n(2);let s={},o={};const i=async function(){await a.open(!0)};let l={};const c=["css","js","woff2","llic","json","o.png","bg.jpg","ico","callback"];self.addEventListener("install",e=>{e.waitUntil(self.skipWaiting())}),self.addEventListener("activate",e=>{e.waitUntil(self.clients.claim())});let u={},d={};const f=async function(e){await a.open();let t=null,n=!1;if("/"==e.request.url.slice(-1))n=!0;else for(let t of c)-1!=e.request.url.indexOf(t)&&(n=!0);if(n||(t=await a.match(e.request.url,{ignoreSearch:!0})),n&&l[e.request.url]&&r.persistServiceWorkerCache)return l[e.request.url].clone();if(-1!=e.request.url.indexOf("/tg/svideo/")){let t=0,n=null;try{const r=/^bytes\=(\d+)\-(\d+)?$/g.exec(e.request.headers.get("range"));t=Number(r[1]),n=Number(r[2])||null}catch(e){t=0}let r=Math.floor(t/524288),s=e.request.url.split("_")[1].split("_")[0],o=t-524288*r,i=null;n&&(i=n-524288*r,i>524287&&(i=524287));let l=e.request.url.split("/tg/svideo/")[0]+"/tg/doc_"+s+"_part_"+r+".dat",c=e.request.url.split("_stream_")[1].split(".")[0],f=null,p=await a.match(l);if(!p){let t="sp"+s+"_"+r;u[t]||(u[t]=new Promise(e=>{d[t]=e}),console.error("sw url",e.request.url),-1==e.request.url.indexOf("preview")&&e.waitUntil(async function(e,t){if(!e.clientId)return;const n=await clients.get(e.clientId);n&&n.postMessage(t)}(e,{command:"waitfor",documentId:s,partN:r}))),f=await u[t],f||(p=await a.match(l))}if(p||f){f||(f=await p.arrayBuffer());let n="video/mp4";-1!=e.request.url.indexOf(".ogg")?n="audio/ogg":-1!=e.request.url.indexOf(".mp3")&&(n="audio/mpeg");let r=f.byteLength-o,a=null;return i?(a=f.slice(o,i+1),r=i-o+1):a=f.slice(o),new Response(a,{status:206,statusText:"Partial Content",headers:[["Content-Type",n],["Content-Range","bytes "+t+"-"+(r+t-1)+"/"+c],["Content-Length",a.byteLength]]})}return new Response(new ArrayBuffer(1),{status:302,statusText:"Found",headers:[]})}if(t||-1==e.request.url.indexOf("/tg/"))return t||(n&&r.persistServiceWorkerCache?(l[e.request.url]=await fetch(e.request),l[e.request.url].clone()):await fetch(e.request));{let n=e.request.url.split("/tg/")[1];s[n]||(s[n]=new Promise((e,t)=>{o[n]=e})),setTimeout(()=>{o[n]&&o[n](!1)},2e4);await s[n];return t=await a.match(e.request,{ignoreSearch:!0}),t}};self.addEventListener("fetch",(function(e){e.respondWith(f(e))})),self.addEventListener("message",e=>{if(e&&e.data)if("clean"==e.data.command){for(let e in o)o[e](null);for(let e in d)d[e](null);s={},o={},d={},u={}}else if("put"==e.data.command)a.open().then(t=>{let n=e.data.cache_id+"."+e.data.ext,r=(e.data.scope?e.data.scope:"")+"/tg/"+n;r=r.split("//").join("/");let s="image/jpeg";"png"==e.data.ext?s="image/png":"json"==e.data.ext&&(s="application/json");const l=new Response(e.data.binary,{status:200,statusText:"OK",headers:{"Content-Type":s,"Content-Length":e.data.binary.byteLength||e.data.binary.size,"Cache-Control":"public, max-age: 86400, immutable",ETag:r}});a.put(r,l).then(()=>{i().then(()=>{o[n]&&o[n](!0)})})});else if("mtp"==e.data.command);else if("fulfill"==e.data.command){let t=e.data.documentId,n=e.data.partN,r=function(t){e.data.ab?d[t]&&d[t](e.data.ab):i().then(()=>{d[t]&&d[t]()})},a="sp"+t+"_";Array.isArray(n)?n.forEach(e=>{r(a+e)}):r(a+n)}})},function(e,t){e.exports={debug:!0,appId:1015231,appHash:"a2848ae779266495f3cd3803f81d91e9",defaultDC:2,keepNotDefaultNetworkers:!0,persistState:!0,test:!1,ssl:!0,websockets:!0,poll:!1,pollInterval:2e3,persistMediaCache:!0,persistServiceWorkerCache:!0,maxParallelConnections:3}},function(e,t){e.exports=new class{constructor(e){this._db=null,this._cacheName="lovegram-0.0.1"}async open(){this._db||(this._db=await this.initDB())}initDB(){return new Promise((e,t)=>{let n=indexedDB.open(this._cacheName,4);n.onerror=function(){t()},n.onupgradeneeded=()=>{const e=n.result;try{e.createObjectStore("files",{keyPath:"url"})}catch(e){}},n.onsuccess=function(){const t=n.result;e(t)}})}store(){return this._db.transaction(["files"],"readwrite").objectStore("files")}async matchFromStore(e,t,n){let r="/tg/"+t.split("/tg/")[1];return new Promise((a,s)=>{const o=e.get(r);o.onerror=function(){a(void 0)},o.onsuccess=function(e){const r=o.result;if(!r)return void a(void 0);let s=new Response(r.data,{status:200});n&&(s=[t,s]),a(s)}})}async matchAll(e){let t=Array.from(new Set(e));const n=this.store(),r=[];for(let e of t)r.push(this.matchFromStore(n,e,!0));return Promise.all(r)}async match(e){const t=this.store();return await this.matchFromStore(t,e)}async deleteUrl(e){let t="/tg/"+e.split("/tg/")[1];const n=this.store();await new Promise((e,r)=>{const a=n.delete(t);a.onerror=function(){e(void 0)},a.onsuccess=function(t){e(!0)}})}delete(){return new Promise((e,t)=>{this.open().then(()=>{this._db.transaction(["files"],"readwrite").objectStore("files").clear().onsuccess=function(t){e()}})})}put(e,t,n){let r="/tg/"+e.split("/tg/")[1];return new Promise((e,a)=>{t.blob().then(t=>{const a=this._db.transaction(["files"],"readwrite"),s=a.objectStore("files"),o={url:r,data:t};try{a.onerror=function(t){e(!0)},a.oncomplete=function(t){e(!0)};s[n?"put":"add"](o).onerror=function(t){e(!0)}}catch(e){console.error(e)}})})}}}]);